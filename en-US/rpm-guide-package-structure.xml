<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [

<!ENTITY % FDP-ENTITIES SYSTEM "fdp-entities.ent">
%FDP-ENTITIES;

]>
<!-- $Id: -->

<chapter id="ch-package-structure">
  <title>RPM Package File Structure</title>
  <para>
    This appendix covers:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        RPM package file structure
      </para>
    </listitem>
    <listitem>
      <para>
        RPM header entry formats
      </para>
    </listitem>
    <listitem>
      <para>
        Payload format
      </para>
    </listitem>
  </itemizedlist>
  <para>
    This appendix describes the format of RPM package files. You can
    combine this information with C, Perl, or Python data structures to
    access the information. In all cases, you should access elements in
    an RPM file using one of the available programming libraries. Do not
    attempt to access the files directly, as you may inadvertently
    damage the RPM file.
  </para>
  <para>
    Cross Reference
  </para>
  <para>
    <xref linkend="ch-programming-c"/>, <xref linkend="ch-rpm-programming-python"/>, and <xref linkend="ch-programming-perl"/> cover programming with C, Python, and Perl, respectively.
  </para>
  <para>
    The RPM package format described here has been standardized as part
    of the Linux Standards Base, or LSB, version 1.3.
  </para>
  <para>
    Cross Reference
  </para>
  <para>
    The LSB 1.3 section on package file formats is available at
    www.linuxbase.org/spec/refspecs/LSB_1.3.0/gLSB/gLSB.html#PACKAGEFMT.
  </para>
  <sect1>
    <title>The Package File</title>
    <para>
      RPM packages are delivered with one file per package. All RPM
      files have the following basic format of four sections:
    </para>
    <para>
      *A lead or file identifier
    </para>
    <para>
      *A signature
    </para>
    <para>
      *Header information
    </para>
    <para>
      *Archive of the payload, the files to install
    </para>
    <para>
      All values are encoded in network byte order, for portability to
      multiple processor architectures.
    </para>
    <sect2>
      <title>The file identifier</title>
      <para>
        Also called the lead or the rpmlead, the identifier marks that
        this file is an RPM file. It contains a magic number that the
        file command uses to detect RPM files. It also contains version
        and architecture information.
      </para>
      <para>
        The start of the identifier is the so-called magic number. The
        file command reads the first few bytes of a file and compares
        the values found with the contents of /usr/share/magic
        (/etc/magic on many UNIX systems), a database of magic numbers.
        This allows the file command to quickly identify files.
      </para>
      <para>
        The identifier includes the RPM version number, that is, the
        version of the RPM file format used for the package. The
        identifier also has a flag that tells the type of the RPM file,
        whether the file contains a binary or source package. An
        architecture flag allows RPM software to double-check that you
        are not trying to install a package for a non-compatible
        architecture.
      </para>
    </sect2>
    <sect2>
      <title>The signature</title>
      <para>
        The signature appears after the lead or identifier section. The
        RPM signature helps verify the integrity of the package, and
        optionally the authenticity.
      </para>
      <para>
        The signature works by performing a mathematical function on the
        header and archive section of the file. The mathematical
        function can be an encryption process, such as PGP (Pretty Good
        Privacy), or a message digest in MD5 format.
      </para>
    </sect2>
    <sect2>
      <title>The header</title>
      <para>
        The identifier section no longer contains enough information to
        describe modern RPMs. Furthermore, the identifier section is
        nowhere near as flexible as todayâ€™s packages require. To
        counter these deficiencies, the header section was introduced to
        include more information about the package.
      </para>
      <para>
        The header structure contains three parts:
      </para>
      <para>
        *Header record
      </para>
      <para>
        *One or more header index record structures
      </para>
      <para>
        *Data for the index record structures
      </para>
      <para>
        The header record identifies this as the RPM header. It also
        contains a count of the number of index records and the size of
        the index record data.
      </para>
      <para>
        Each index record uses a structure that contains a tag number
        for the data it contains. This includes tag IDs for the
        copyright message, name of the package, version number, and so
        on. A type number identifies the type of the item. An offset
        indicates where in the data section the data for this header
        item begins. A count indicates how many items of the given type
        are in this header entry. You can multiply the count by the size
        of the type to get the number of bytes used for the header
        entry.
      </para>
      <para>
        Table D-1 lists the type identifiers.
      </para>
      <para>
        Table D-1 Header type identifiers
      </para>
      <informaltable frame="all">
        <tgroup cols="3">
          <tbody>
            <row>
              <entry>
                <para>
                  Constant
                </para>
              </entry>
              <entry>
                <para>
                  Value
                </para>
              </entry>
              <entry>
                <para>
                  Size in Bytes
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_NULL_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  0
                </para>
              </entry>
              <entry>
                <para>
                  No size
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_CHAR_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  1
                </para>
              </entry>
              <entry>
                <para>
                  1
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_INT8_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  2
                </para>
              </entry>
              <entry>
                <para>
                  1
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_INT16_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  3
                </para>
              </entry>
              <entry>
                <para>
                  2
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_INT32_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  4
                </para>
              </entry>
              <entry>
                <para>
                  4
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_INT64_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  5
                </para>
              </entry>
              <entry>
                <para>
                  Not supported yet
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_STRING_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  6
                </para>
              </entry>
              <entry>
                <para>
                  Variable number of bytes, terminated by a NULL
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_BIN_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  7
                </para>
              </entry>
              <entry>
                <para>
                  1
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_STRING_ARRAY_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  8
                </para>
              </entry>
              <entry>
                <para>
                  Variable, vector of NULL-terminated strings
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  RPM_I18NSTRING_TYPE
                </para>
              </entry>
              <entry>
                <para>
                  9
                </para>
              </entry>
              <entry>
                <para>
                  Variable, vector of NULL-terminated strings
                </para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <para>
        Note
      </para>
      <para>
        Integer values are aligned on 2-byte (16-bit integers) or 4-byte
        (32-bit integers) boundaries.
      </para>
      <sect3>
        <title>Header Tags</title>
        <para>
          Table D-2 lists the tag identifiers.
        </para>
        <para>
          Table D-2 Header entry tag identifiers
        </para>
        <informaltable frame="all">
          <tgroup cols="4">
            <tbody>
              <row>
                <entry>
                  <para>
                    Constant
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
                <entry>
                  <para>
                    Type
                  </para>
                </entry>
                <entry>
                  <para>
                    Required?
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_NAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1000
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_VERSION
                  </para>
                </entry>
                <entry>
                  <para>
                    1001
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_RELEASE
                  </para>
                </entry>
                <entry>
                  <para>
                    1002
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_SUMMARY
                  </para>
                </entry>
                <entry>
                  <para>
                    1004
                  </para>
                </entry>
                <entry>
                  <para>
                    I18NSTRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_DESCRIPTION
                  </para>
                </entry>
                <entry>
                  <para>
                    1005
                  </para>
                </entry>
                <entry>
                  <para>
                    I18NSTRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_BUILDTIME
                  </para>
                </entry>
                <entry>
                  <para>
                    1006
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_BUILDHOST
                  </para>
                </entry>
                <entry>
                  <para>
                    1007
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_SIZE
                  </para>
                </entry>
                <entry>
                  <para>
                    1009
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_LICENSE
                  </para>
                </entry>
                <entry>
                  <para>
                    1014
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_GROUP
                  </para>
                </entry>
                <entry>
                  <para>
                    1016
                  </para>
                </entry>
                <entry>
                  <para>
                    I18NSTRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_OS
                  </para>
                </entry>
                <entry>
                  <para>
                    1021
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_ARCH
                  </para>
                </entry>
                <entry>
                  <para>
                    1022
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_SOURCERPM
                  </para>
                </entry>
                <entry>
                  <para>
                    1044
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEVERIFYFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1045
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_ARCHIVESIZE
                  </para>
                </entry>
                <entry>
                  <para>
                    1046
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_RPMVERSION
                  </para>
                </entry>
                <entry>
                  <para>
                    1064
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_CHANGELOGTIME
                  </para>
                </entry>
                <entry>
                  <para>
                    1080
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_CHANGELOGNAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1081
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_CHANGELOGTEXT
                  </para>
                </entry>
                <entry>
                  <para>
                    1082
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_COOKIE
                  </para>
                </entry>
                <entry>
                  <para>
                    1094
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_OPTFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1122
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PAYLOADFORMAT
                  </para>
                </entry>
                <entry>
                  <para>
                    1124
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PAYLOADCOMPRESSOR
                  </para>
                </entry>
                <entry>
                  <para>
                    1125
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PAYLOADFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1126
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_RHNPLATFORM
                  </para>
                </entry>
                <entry>
                  <para>
                    1131
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Deprecated
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PLATFORM
                  </para>
                </entry>
                <entry>
                  <para>
                    1132
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          Most of these tags are self-explanatory; however, a few tags
          hold special meaning. The RPMTAG_SIZE tag holds the size of
          all the regular files in the payload. The RPMTAG_ARCHIVESIZE
          tag holds the uncompressed size of the payload section,
          including the necessary cpio headers. The RPMTAG_COOKIE tag
          holds an opaque string.
        </para>
        <para>
          According to the LSB standards, the RPMTAG_PAYLOADFORMAT must
          always be cpio. The RPMTAG_PAYLOADCOMPRESSOR must be gzip. The
          RPMTAG_PAYLOADFLAGS must always be 9.
        </para>
        <para>
          The RPMTAG_OPTFLAGS tag holds special compiler flags used to
          build the package. The RPMTAG_PLATFORM and RPMTAG_RHNPLATFORM
          tags hold opaque strings.
        </para>
      </sect3>
      <sect3>
        <title>Private Header Tags</title>
        <para>
          Table D-3 lists header tags that are considered private.
        </para>
        <para>
          Table D-3 Private header tags
        </para>
        <informaltable frame="all">
          <tgroup cols="4">
            <tbody>
              <row>
                <entry>
                  <para>
                    Constant
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
                <entry>
                  <para>
                    Type
                  </para>
                </entry>
                <entry>
                  <para>
                    Required?
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_HEADERSIGNATURES
                  </para>
                </entry>
                <entry>
                  <para>
                    62
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_HEADERIMMUTABLE
                  </para>
                </entry>
                <entry>
                  <para>
                    63
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_HEADERI18NTABLE
                  </para>
                </entry>
                <entry>
                  <para>
                    100
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          The RPMTAG_HEADERSIGNATURES tag indicates that this is a
          signature entry. The RPMTAG_HEADERIMMUTABLE tag indicates a
          header item that is used in the calculation of signatures.
          This data should be preserved.
        </para>
        <para>
          The RPMTAG_HEADERI18NTABLE tag holds a table of locales used
          for international text lookup.
        </para>
      </sect3>
      <sect3>
        <title>Signature Tags</title>
        <para>
          The signature section is implemented as a header structure,
          but it is not considered part of the RPM header. Table D-4
          lists special signature-related tags.
        </para>
        <para>
          Table D-4 Signature-related tags
        </para>
        <informaltable frame="all">
          <tgroup cols="4">
            <tbody>
              <row>
                <entry>
                  <para>
                    Constant
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
                <entry>
                  <para>
                    Type
                  </para>
                </entry>
                <entry>
                  <para>
                    Required?
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_SIGSIZE
                  </para>
                </entry>
                <entry>
                  <para>
                    1000
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_PGP
                  </para>
                </entry>
                <entry>
                  <para>
                    1002
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_MD5
                  </para>
                </entry>
                <entry>
                  <para>
                    1004
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_GPG
                  </para>
                </entry>
                <entry>
                  <para>
                    1005
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_PAYLOADSIZE
                  </para>
                </entry>
                <entry>
                  <para>
                    1007
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_SHA1HEADER
                  </para>
                </entry>
                <entry>
                  <para>
                    1010
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_DSAHEADER
                  </para>
                </entry>
                <entry>
                  <para>
                    1011
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    SIGTAG_RSAHEADER
                  </para>
                </entry>
                <entry>
                  <para>
                    1012
                  </para>
                </entry>
                <entry>
                  <para>
                    BIN
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          The SIGTAG_SIGSIZE tag specifies the size of the header and
          payload sections, while the SIGTAG_PAYLOADSIZE holds the
          uncompressed size of the payload.
        </para>
        <para>
          To verify the integrity of the package, the SIGTAG_MD5 tag
          holds a 128-bit MD5 checksum of the header and payload
          sections. The SIGTAG_SHA1HEADER holds an SHA1 checksum of the
          entire header section.
        </para>
        <para>
          To verify the authenticity of the package, the SIGTAG_PGP tag
          holds a Version 3 OpenPGP Signature Packet RSA signature of
          the header and payload areas. The SIGTAG_GPG tag holds a
          Version 3 OpenPGP Signature Packet DSA signature of the header
          and payload areas. The SIGTAG_DSAHEADER holds a DSA signature
          of just the header section. If the SIGTAG_DSAHEADER tag is
          included, the SIGTAG_GPG tag must also be present. The SIGTAG_
          RSAHEADER holds an RSA signature of just the header section.
          If the SIGTAG_ RSAHEADER tag is included, the SIGTAG_PGP tag
          must also be present.
        </para>
      </sect3>
      <sect3>
        <title>Installation Tags</title>
        <para>
          A set of installation-specific tags tells the rpm program how
          to run the pre- and post-installation scripts. Table D-5 lists
          these tags.
        </para>
        <para>
          Table D-5 Installation tags
        </para>
        <informaltable frame="all">
          <tgroup cols="4">
            <tbody>
              <row>
                <entry>
                  <para>
                    Constant
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
                <entry>
                  <para>
                    Type
                  </para>
                </entry>
                <entry>
                  <para>
                    Required?
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PREINPROG
                  </para>
                </entry>
                <entry>
                  <para>
                    1085
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_POSTINPROG
                  </para>
                </entry>
                <entry>
                  <para>
                    1086
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PREUNPROG
                  </para>
                </entry>
                <entry>
                  <para>
                    1087
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_POSTUNPROG
                  </para>
                </entry>
                <entry>
                  <para>
                    1088
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          The RPMTAG_PREINPROG tag holds the name of the interpreter,
          such as sh, to run the pre-install script. Similarly, the
          RPMTAG_POSTINPROG tag holds the name of the interpreter to run
          the post-install script. RPMTAG_PREUNPROG and
          RPMTAG_POSTUNPROG are the same for the uninstall scripts.
        </para>
      </sect3>
      <sect3>
        <title>File Information Tags</title>
        <para>
          File information tags are placed in the header for convenient
          access. These tags describe the files in the payload. Table
          D-6 lists these tags.
        </para>
        <para>
          Table D-6 File information tags
        </para>
        <informaltable frame="all">
          <tgroup cols="4">
            <tbody>
              <row>
                <entry>
                  <para>
                    Constant
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
                <entry>
                  <para>
                    Type
                  </para>
                </entry>
                <entry>
                  <para>
                    Required?
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_OLDFILENAMES
                  </para>
                </entry>
                <entry>
                  <para>
                    1027
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILESIZES
                  </para>
                </entry>
                <entry>
                  <para>
                    1028
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEMODES
                  </para>
                </entry>
                <entry>
                  <para>
                    1030
                  </para>
                </entry>
                <entry>
                  <para>
                    INT16
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILERDEVS
                  </para>
                </entry>
                <entry>
                  <para>
                    1033
                  </para>
                </entry>
                <entry>
                  <para>
                    INT16
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEMTIMES
                  </para>
                </entry>
                <entry>
                  <para>
                    1034
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEMD5S
                  </para>
                </entry>
                <entry>
                  <para>
                    1035
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILELINKTOS
                  </para>
                </entry>
                <entry>
                  <para>
                    1036
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1037
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEUSERNAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1039
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEGROUPNAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1040
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEDEVICES
                  </para>
                </entry>
                <entry>
                  <para>
                    1095
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILEINODES
                  </para>
                </entry>
                <entry>
                  <para>
                    1096
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_FILELANGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1097
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_DIRINDEXES
                  </para>
                </entry>
                <entry>
                  <para>
                    1116
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_BASENAMES
                  </para>
                </entry>
                <entry>
                  <para>
                    1117
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_DIRNAMES
                  </para>
                </entry>
                <entry>
                  <para>
                    1118
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          The RPMTAG_OLDFILENAMES tag is used when the files are not
          compressed, when the RPMTAG_REQUIRENAME tag does not indicate
          rpmlib(CompressedFileNames). The RPMTAG_FILESIZES tag
          specifies the size of each file in the payload, while the
          RPMTAG_FILEMODES tag specifies the file modes (permissions)
          and the RPMTAG_FILEMTIMES tag holds the last modification time
          for each file.
        </para>
        <para>
          The RPMTAG_BASENAMES tag holds an array of the base file names
          for the files in the payload. The RPMTAG_DIRNAMES tag holds an
          array of the directories for the files. The RPMTAG_DIRINDEXES
          tag contains an index into the RPMTAG_DIRNAMES for the
          directory. Each RPM must have either RPMTAG_OLDFILENAMES or
          the triple of RPMTAG_BASENAMES, RPMTAG_DIRNAMES, and
          RPMTAG_DIRINDEXES, but not both.
        </para>
      </sect3>
      <sect3>
        <title>Dependency Tags</title>
        <para>
          The dependency tags provide one of the most useful features of
          the RPM system by allowing for automated dependency checks
          between packages. Table D-7 lists these tags.
        </para>
        <para>
          Table D-7 Dependency tags
        </para>
        <informaltable frame="all">
          <tgroup cols="4">
            <tbody>
              <row>
                <entry>
                  <para>
                    Constant
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
                <entry>
                  <para>
                    Type
                  </para>
                </entry>
                <entry>
                  <para>
                    Required?
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PROVIDENAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1047
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_REQUIREFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1048
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_REQUIRENAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1049
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_REQUIREVERSION
                  </para>
                </entry>
                <entry>
                  <para>
                    1050
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_CONFLICTFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1053
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_CONFLICTNAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1054
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_CONFLICTVERSION
                  </para>
                </entry>
                <entry>
                  <para>
                    1055
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_OBSOLETENAME
                  </para>
                </entry>
                <entry>
                  <para>
                    1090
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PROVIDEFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1112
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_PROVIDEVERSION
                  </para>
                </entry>
                <entry>
                  <para>
                    1113
                  </para>
                </entry>
                <entry>
                  <para>
                    STRING_ARRAY
                  </para>
                </entry>
                <entry>
                  <para>
                    Yes
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_OBSOLETEFLAGS
                  </para>
                </entry>
                <entry>
                  <para>
                    1114
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMTAG_OBSOLETEVERSION
                  </para>
                </entry>
                <entry>
                  <para>
                    1115
                  </para>
                </entry>
                <entry>
                  <para>
                    INT32
                  </para>
                </entry>
                <entry>
                  <para>
                    Optional
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          Each of these tags comes in triples, which are formatted
          similarly. The RPMTAG_REQUIRENAME tag holds an array of
          required capabilities. The RPMTAG_REQUIREVERSION tag holds an
          array of the versions of the required capabilities. The
          RPMTAG_REQUIREFLAGS tag ties the two together with a set of
          bit flags that specify whether the requirement is for a
          version less than the given number, equal to the given number,
          greater than or equal to the given number, and so on. Table
          D-8 lists these flags.
        </para>
        <para>
          Table D-8 Bit flags for dependencies
        </para>
        <informaltable frame="all">
          <tgroup cols="2">
            <tbody>
              <row>
                <entry>
                  <para>
                    Flag
                  </para>
                </entry>
                <entry>
                  <para>
                    Value
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_LESS
                  </para>
                </entry>
                <entry>
                  <para>
                    0x02
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_GREATER
                  </para>
                </entry>
                <entry>
                  <para>
                    0x04
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_EQUAL
                  </para>
                </entry>
                <entry>
                  <para>
                    0x08
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_PREREQ
                  </para>
                </entry>
                <entry>
                  <para>
                    0x40
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_INTERP
                  </para>
                </entry>
                <entry>
                  <para>
                    0x100
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_SCRIPT_PRE
                  </para>
                </entry>
                <entry>
                  <para>
                    0x200
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_SCRIPT_POST
                  </para>
                </entry>
                <entry>
                  <para>
                    0x400
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_SCRIPT_PREUN
                  </para>
                </entry>
                <entry>
                  <para>
                    0x800
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    RPMSENSE_SCRIPT_POSTUN
                  </para>
                </entry>
                <entry>
                  <para>
                    0x1000
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <para>
          The RPMTAG_PROVIDENAME, RPMTAG_PROVIDEVERSION, and
          RPMTAG_PROVIDEFLAGS tags work similarly for the capabilities
          this package provides. The RPMTAG_CONFLICTNAME,
          RPMTAG_CONFLICTVERSION, and RPMTAG_CONFLICTFLAGS tags specify
          the conflicts. The RPMTAG_OBSOLETENAME,
          RPMTAG_OBSOLETEVERSION, and RPMTAG_OBSOLETEFLAGS tags specify
          the obsoleted dependencies.
        </para>
        <para>
          In addition, an RPM package can define some special
          requirements in the RPMTAG_REQUIRENAME and
          RPMTAG_REQUIREVERSION tags. Table D-9 lists these
          requirements.
        </para>
        <para>
          Table D-9 Special package requirement names and versions
        </para>
        <informaltable frame="all">
          <tgroup cols="3">
            <tbody>
              <row>
                <entry>
                  <para>
                    Name
                  </para>
                </entry>
                <entry>
                  <para>
                    Version
                  </para>
                </entry>
                <entry>
                  <para>
                    Specifies
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    Lsb
                  </para>
                </entry>
                <entry>
                  <para>
                    1.3
                  </para>
                </entry>
                <entry>
                  <para>
                    The package conforms to the Linux Standards Base RPM
                    format.
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    rpmlib(VersionedDependencies)
                  </para>
                </entry>
                <entry>
                  <para>
                    3.0.3-1
                  </para>
                </entry>
                <entry>
                  <para>
                    The package holds dependencies or prerequisites that
                    have versions associated with them.
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    rpmlib(PayloadFilesHavePrefix)
                  </para>
                </entry>
                <entry>
                  <para>
                    4.0-1
                  </para>
                </entry>
                <entry>
                  <para>
                    File names in the archive have a â€œ.â€ prepended
                    on the names.
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    rpmlib(CompressedFileNames)
                  </para>
                </entry>
                <entry>
                  <para>
                    3.0.4-1
                  </para>
                </entry>
                <entry>
                  <para>
                    The package uses the RPMTAG_DIRINDEXES,
                    RPMTAG_DIRNAME and RPMTAG_BASENAMES tags for
                    specifying file names.
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  <para>
                    /bin/sh
                  </para>
                </entry>
                <entry>
                  <para>
                    NA
                  </para>
                </entry>
                <entry>
                  <para>
                    Indicates a requirement for the Bourne shell to run
                    the installation scripts.
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
      </sect3>
    </sect2>
    <sect2>
      <title>The payload</title>
      <para>
        The payload, or archive, section contains the actual files used
        in the package. These are the files that the rpm command
        installs when you install the package. To save space, data in
        the archive section is compressed in GNU gzip format.
      </para>
      <para>
        Once uncompressed, the data is in cpio format, which is how the
        rpm2cpio command can do its work. In cpio format, the payload is
        made up of records, one per file. Table D-10 lists the record
        structure.
      </para>
      <para>
        Table D-10 cpio file record structure
      </para>
      <informaltable frame="all">
        <tgroup cols="2">
          <tbody>
            <row>
              <entry>
                <para>
                  Element
                </para>
              </entry>
              <entry>
                <para>
                  Holds
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  cpio header
                </para>
              </entry>
              <entry>
                <para>
                  Information on the file, such as the file mode
                  (permissions)
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  File name
                </para>
              </entry>
              <entry>
                <para>
                  NULL-terminated string
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  Padding
                </para>
              </entry>
              <entry>
                <para>
                  0 to 3 bytes, as needed, to align the next element on
                  a 4-byte boundary
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  File data
                </para>
              </entry>
              <entry>
                <para>
                  The contents of the file
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  Padding
                </para>
              </entry>
              <entry>
                <para>
                  0 to 3 bytes, as needed, to align the next file record
                  on a 4-byte boundary
                </para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <para>
        The information in the cpio header duplicates that of the RPM
        file-information header elements.
      </para>
    </sect2>
  </sect1>
</chapter>

<!--
Local variables:
mode: xml
sgml-parent-document:("rpm-guide.xml" "book" "chapter")
fill-column: 72
End:
-->
